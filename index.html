<!DOCTYPE html>
<html>
<head>
    <title>monty-leddington</title>
    <style>
        button { font-size: 150px; display: block; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <button id="connect" onclick="connect()">Connect</button>
    <div id="hidden" class="hidden">
        <button onclick="change([0, 0, 100, 100])">Red</button>
        <button onclick="change([0, 100, 0, 100])">Green</button>
        <button onclick="change([100, 0, 0, 100])">Blue</button>
    </div>
    <div id="results"></div>

    <script>
        var serviceUUID = "0000a000-0000-1000-8000-00805f9b34fb";
        var controlUUID = "0000a001-0000-1000-8000-00805f9b34fb";

        var connectEl = document.getElementById("connect");
        var hiddenEl = document.getElementById("hidden");
        var resultsEl = document.getElementById("results");

        function log(message) {
            console.log(message);
            //resultsEl.innerText += message + "\n";
        }

        var ledChar = null;
        function connect() {
            navigator.bluetooth.requestDevice({
                filters: [{ services: [0xA000] }],
                optionalServices: [serviceUUID]
            })
            .then(device => device.connectGATT())
            .then(server => server.getPrimaryService(serviceUUID))
            .then(service => service.getCharacteristic(controlUUID))
            .then(characteristic => {
                ledChar = characteristic;
                connectEl.className = "hidden";
                hiddenEl.className = "";
            })
            .catch(error => {
                log(error);
            });
        }

        function change(value) {
            if (ledChar) {
                ledChar.writeValue(new Uint8Array(value))
                .catch(error => {
                    log(error);
                });
            }
        }
    </script>
</body>
</html>
